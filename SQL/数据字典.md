提供首页统计数据的汇总视图

**字段说明**:
- `total_projects`: 代理项目总数
- `total_amount`: 代理总额（万元）
- `total_regions`: 覆盖区域数
- `gov_procurement_count`: 政府采购公告数量
- `construction_count`: 建设工程公告数量

**SQL定义**:
```sql
SELECT 
  (SELECT COUNT(*) FROM transaction_data WHERE is_deleted = 0) AS total_projects,
  (SELECT COALESCE(SUM(project_amount), 0) FROM transaction_data WHERE is_deleted = 0) AS total_amount,
  (SELECT COUNT(DISTINCT project_region) FROM transaction_data WHERE is_deleted = 0) AS total_regions,
  (SELECT COUNT(*) FROM government_procurement_notices WHERE is_deleted = 0) AS gov_procurement_count,
  (SELECT COUNT(*) FROM construction_project_notices WHERE is_deleted = 0) AS construction_count;
```

---

### 7.2 v_transaction_type_statistics (交易类型占比统计视图)

**视图说明**: 提供交易类型的统计分析数据

**字段说明**:
- `project_type`: 项目类型
- `project_count`: 项目数量
- `total_amount`: 总金额（万元）
- `percentage`: 占比百分比

**SQL定义**:
```sql
SELECT 
  project_type,
  COUNT(*) AS project_count,
  COALESCE(SUM(project_amount), 0) AS total_amount,
  ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM transaction_data WHERE is_deleted = 0), 2) AS percentage
FROM transaction_data
WHERE is_deleted = 0
GROUP BY project_type
ORDER BY project_count DESC;
```

---

### 7.3 v_region_ranking_statistics (地区排行统计视图)

**视图说明**: 提供各地区项目数量和金额排行

**字段说明**:
- `project_region`: 项目区域
- `project_count`: 项目数量
- `total_amount`: 总金额（万元）

**SQL定义**:
```sql
SELECT 
  project_region,
  COUNT(*) AS project_count,
  COALESCE(SUM(project_amount), 0) AS total_amount
FROM transaction_data
WHERE is_deleted = 0
GROUP BY project_region
ORDER BY total_amount DESC, project_count DESC
LIMIT 10;
```

---

## 8. 通用字段说明

### 8.1 时间戳字段

所有表都包含以下标准时间戳字段：

| 字段名 | 说明 |
|--------|------|
| created_at | 记录创建时间，默认为当前时间戳 |
| updated_at | 记录更新时间，自动更新为当前时间戳 |

### 8.2 软删除字段

所有表都使用软删除机制：

| 字段名 | 说明 |
|--------|------|
| is_deleted | 0-未删除（默认），1-已删除 |

**注意**: 查询时需要添加 `WHERE is_deleted = 0` 条件过滤已删除记录

### 8.3 状态字段

部分表包含状态控制字段：

| 字段名 | 说明 |
|--------|------|
| status | 0-禁用，1-启用（默认） |

### 8.4 排序字段

部分表包含排序控制字段：

| 字段名 | 说明 |
|--------|------|
| sort_order | 排序顺序，数字越小越靠前，默认为0 |

### 8.5 置顶字段

公告类表包含置顶控制字段：

| 字段名 | 说明 |
|--------|------|
| is_top | 0-不置顶（默认），1-置顶 |

---

## 9. 数据类型说明

### 9.1 字符串类型

| 类型 | 长度 | 用途 |
|------|------|------|
| VARCHAR(20) | 20字符 | 短文本（如手机号） |
| VARCHAR(50) | 50字符 | 中等文本（如用户名、角色名） |
| VARCHAR(100) | 100字符 | 较长文本（如邮箱、链接名称） |
| VARCHAR(255) | 255字符 | 标题、名称等 |
| VARCHAR(500) | 500字符 | URL、路径等 |
| TEXT | 65,535字符 | 长文本（如描述） |
| LONGTEXT | 4GB | 超长文本（如富文本内容） |

### 9.2 数值类型

| 类型 | 说明 |
|------|------|
| TINYINT | 小整数（-128到127或0到255） |
| INT UNSIGNED | 无符号整数（0到4,294,967,295） |
| BIGINT UNSIGNED | 无符号大整数 |
| DECIMAL(15,2) | 精确小数，15位总长度，2位小数 |

### 9.3 日期时间类型

| 类型 | 格式 | 说明 |
|------|------|------|
| DATE | YYYY-MM-DD | 日期 |
| DATETIME | YYYY-MM-DD HH:MM:SS | 日期时间 |

---

## 10. 索引策略

### 10.1 主键索引
- 所有表都使用自增ID作为主键
- 类型：INT UNSIGNED 或 BIGINT UNSIGNED

### 10.2 唯一索引
- 用户名、角色代码、区域代码等需要唯一性的字段

### 10.3 普通索引
- 外键字段
- 常用查询条件字段（如状态、类型、日期）
- 软删除标记字段

### 10.4 全文索引
- 标题和内容字段（用于全文搜索）
- 仅在需要全文检索的表中使用

---

## 11. 外键约束

### 11.1 admin_users → admin_roles
- 外键字段：`role_id`
- 引用表：`admin_roles(id)`
- 删除策略：ON DELETE SET NULL（角色删除时，用户角色设为NULL）
- 更新策略：ON UPDATE CASCADE（角色ID更新时，级联更新）

---

## 12. 字符集和排序规则

- **字符集**: utf8mb4（支持完整的Unicode字符，包括emoji）
- **排序规则**: utf8mb4_unicode_ci（不区分大小写的Unicode排序）

---

## 13. 存储引擎

- **引擎**: InnoDB
- **特性**:
  - 支持事务（ACID）
  - 支持外键约束
  - 行级锁定
  - 崩溃恢复能力

---

## 14. 安全性说明

### 14.1 密码加密
- 管理员密码使用 SHA2(password, 256) 加密存储
- 初始密码：123456（建议首次登录后修改）

### 14.2 软删除
- 所有表采用软删除机制，保留历史数据
- 删除操作仅标记 `is_deleted = 1`，不物理删除

### 14.3 操作日志
- system_logs 表记录所有关键操作
- 包含操作人、时间、IP、操作内容等信息

---

## 15. 性能优化建议

### 15.1 索引优化
- 根据实际查询需求添加组合索引
- 定期分析慢查询日志
- 使用 EXPLAIN 分析查询计划

### 15.2 分区策略
- 对于大数据量表（如访问统计、系统日志），可考虑按日期分区
- 示例：按月分区 `visit_statistics` 表

### 15.3 缓存策略
- 使用 Redis 缓存热点数据
- 缓存首页统计数据
- 缓存常用配置信息

### 15.4 定期维护
- 定期清理过期的软删除数据
- 定期优化表（OPTIMIZE TABLE）
- 定期备份数据库

---

## 16. 数据备份建议

### 16.1 备份策略
- 每日全量备份
- 每小时增量备份
- 保留最近30天的备份

### 16.2 备份命令示例
```bash
# 全量备份
mysqldump -u root -p hailong_consulting > backup_$(date +%Y%m%d_%H%M%S).sql

# 备份指定表
mysqldump -u root -p hailong_consulting admin_users admin_roles > users_backup.sql
```

### 16.3 恢复命令示例
```bash
# 恢复数据库
mysql -u root -p hailong_consulting < backup_20231203_100000.sql
```

---

## 17. 常用查询示例

### 17.1 查询首页统计数据
```sql
SELECT * FROM v_homepage_statistics;
```

### 17.2 查询最新公告（前10条）
```sql
SELECT id, title, publish_time, view_count 
FROM government_procurement_notices 
WHERE is_deleted = 0 
ORDER BY is_top DESC, publish_time DESC 
LIMIT 10;
```

### 17.3 查询某地区的项目统计
```sql
SELECT 
  project_type,
  COUNT(*) as count,
  SUM(project_amount) as total_amount
FROM transaction_data
WHERE project_region = '郑州市' AND is_deleted = 0
GROUP BY project_type;
```

### 17.4 全文搜索公告
```sql
SELECT id, title, publish_time
FROM government_procurement_notices
WHERE MATCH(title, content) AGAINST('医疗设备' IN NATURAL LANGUAGE MODE)
  AND is_deleted = 0
ORDER BY publish_time DESC;
```

---

## 18. 版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| 1.0 | 2025-12-03 | 初始版本，完成基础数据库结构设计 |

---

## 19. 联系方式

如有数据库相关问题，请联系技术团队。

---

**文档结束**